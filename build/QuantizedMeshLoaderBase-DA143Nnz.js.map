{"version":3,"file":"QuantizedMeshLoaderBase-DA143Nnz.js","sources":["../src/core/plugins/auth/CesiumIonAuth.js","../src/core/plugins/GoogleAttributionsManager.js","../src/core/plugins/GoogleCloudAuthPlugin.js","../src/core/plugins/CesiumIonAuthPlugin.js","../src/core/plugins/auth/GoogleCloudAuth.js","../src/core/plugins/loaders/QuantizedMeshLoaderBase.js"],"sourcesContent":["// Class for making fetches to Cesium Ion, refreshing the token if needed.\nexport class CesiumIonAuth {\n\n\tconstructor( options = {} ) {\n\n\t\tconst { apiToken, autoRefreshToken = false } = options;\n\t\tthis.apiToken = apiToken;\n\t\tthis.autoRefreshToken = autoRefreshToken;\n\t\tthis.authURL = null;\n\t\tthis._tokenRefreshPromise = null;\n\t\tthis._bearerToken = null;\n\n\t}\n\n\tasync fetch( url, options ) {\n\n\t\tawait this._tokenRefreshPromise;\n\n\t\t// insert the authorization token\n\t\tconst fetchOptions = { ...options };\n\t\tfetchOptions.headers = fetchOptions.headers || {};\n\t\tfetchOptions.headers = {\n\t\t\t...fetchOptions.headers,\n\t\t\tAuthorization: this._bearerToken,\n\t\t};\n\n\t\t// try to refresh the token if we failed to load the tile data\n\t\tconst res = await fetch( url, fetchOptions );\n\t\tif ( res.status >= 400 && res.status <= 499 && this.autoRefreshToken ) {\n\n\t\t\t// refresh the bearer token\n\t\t\tawait this.refreshToken( options );\n\t\t\tfetchOptions.headers.Authorization = this._bearerToken;\n\n\t\t\treturn fetch( url, fetchOptions );\n\n\t\t} else {\n\n\t\t\treturn res;\n\n\t\t}\n\n\t}\n\n\trefreshToken( options ) {\n\n\t\tif ( this._tokenRefreshPromise === null ) {\n\n\t\t\t// construct the url to fetch the endpoint\n\t\t\tconst url = new URL( this.authURL );\n\t\t\turl.searchParams.set( 'access_token', this.apiToken );\n\n\t\t\tthis._tokenRefreshPromise = fetch( url, options )\n\t\t\t\t.then( res => {\n\n\t\t\t\t\tif ( ! res.ok ) {\n\n\t\t\t\t\t\tthrow new Error( `CesiumIonAuthPlugin: Failed to load data with error code ${ res.status }` );\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn res.json();\n\n\t\t\t\t} )\n\t\t\t\t.then( json => {\n\n\t\t\t\t\tthis._bearerToken = `Bearer ${ json.accessToken }`;\n\t\t\t\t\tthis._tokenRefreshPromise = null;\n\n\t\t\t\t\treturn json;\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\treturn this._tokenRefreshPromise;\n\n\t}\n\n}\n","export class GoogleAttributionsManager {\n\n\tconstructor() {\n\n\t\tthis.creditsCount = {};\n\n\t}\n\n\t_adjustAttributions( line, add ) {\n\n\t\tconst creditsCount = this.creditsCount;\n\t\tconst tokens = line.split( /;/g );\n\t\tfor ( let i = 0, l = tokens.length; i < l; i ++ ) {\n\n\t\t\tconst t = tokens[ i ];\n\t\t\tif ( ! ( t in creditsCount ) ) {\n\n\t\t\t\tcreditsCount[ t ] = 0;\n\n\t\t\t}\n\n\t\t\tcreditsCount[ t ] += add ? 1 : - 1;\n\n\t\t\tif ( creditsCount[ t ] <= 0 ) {\n\n\t\t\t\tdelete creditsCount[ t ];\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\taddAttributions( line ) {\n\n\t\tthis._adjustAttributions( line, true );\n\n\t}\n\n\tremoveAttributions( line ) {\n\n\t\tthis._adjustAttributions( line, false );\n\n\t}\n\n\ttoString() {\n\n\t\t// attribution guidelines: https://developers.google.com/maps/documentation/tile/create-renderer#display-attributions\n\n\t\tconst sortedByCount = Object.entries( this.creditsCount ).sort( ( a, b ) => {\n\n\t\t\tconst countA = a[ 1 ];\n\t\t\tconst countB = b[ 1 ];\n\t\t\treturn countB - countA; // Descending order\n\n\t\t} );\n\n\t\treturn sortedByCount.map( pair => pair[ 0 ] ).join( '; ' );\n\n\t}\n\n}\n","import { GoogleCloudAuth } from '3d-tiles-renderer/core/plugins';\nimport { GoogleAttributionsManager } from './GoogleAttributionsManager.js';\n\nconst TILES_3D_API = 'https://tile.googleapis.com/v1/3dtiles/root.json';\n\nexport class GoogleCloudAuthPlugin {\n\n\tconstructor( {\n\t\tapiToken,\n\t\tsessionOptions = null,\n\t\tautoRefreshToken = false,\n\t\tlogoUrl = null,\n\t\tuseRecommendedSettings = true,\n\t} ) {\n\n\t\tthis.name = 'GOOGLE_CLOUD_AUTH_PLUGIN';\n\n\t\tthis.apiToken = apiToken;\n\t\tthis.useRecommendedSettings = useRecommendedSettings;\n\t\tthis.logoUrl = logoUrl;\n\n\t\tthis.auth = new GoogleCloudAuth( { apiToken, autoRefreshToken, sessionOptions } );\n\t\tthis.tiles = null;\n\n\t\tthis._visibilityChangeCallback = null;\n\t\tthis._attributionsManager = new GoogleAttributionsManager();\n\t\tthis._logoAttribution = {\n\t\t\tvalue: '',\n\t\t\ttype: 'image',\n\t\t\tcollapsible: false,\n\t\t};\n\t\tthis._attribution = {\n\t\t\tvalue: '',\n\t\t\ttype: 'string',\n\t\t\tcollapsible: true,\n\t\t};\n\n\t}\n\n\tinit( tiles ) {\n\n\t\tconst { useRecommendedSettings, auth } = this;\n\n\t\t// reset the tiles in case this plugin was removed and re-added\n\t\ttiles.resetFailedTiles();\n\n\t\tif ( tiles.rootURL == null ) {\n\n\t\t\ttiles.rootURL = TILES_3D_API;\n\n\t\t}\n\n\t\tif ( ! auth.sessionOptions ) {\n\n\t\t\tauth.authURL = tiles.rootURL;\n\n\t\t}\n\n\t\tif ( useRecommendedSettings && ! auth.isMapTilesSession ) {\n\n\t\t\t// This plugin changes below values to be more efficient for the photorealistic tiles\n\t\t\ttiles.errorTarget = 20;\n\n\t\t}\n\n\t\tthis.tiles = tiles;\n\n\t\tthis._visibilityChangeCallback = ( { tile, visible } ) => {\n\n\t\t\tconst copyright = tile.cached.metadata?.asset?.copyright || '';\n\t\t\tif ( visible ) {\n\n\t\t\t\tthis._attributionsManager.addAttributions( copyright );\n\n\t\t\t} else {\n\n\t\t\t\tthis._attributionsManager.removeAttributions( copyright );\n\n\t\t\t}\n\n\t\t};\n\n\t\ttiles.addEventListener( 'tile-visibility-change', this._visibilityChangeCallback );\n\n\t}\n\n\tgetAttributions( target ) {\n\n\t\tif ( this.tiles.visibleTiles.size > 0 ) {\n\n\t\t\tif ( this.logoUrl ) {\n\n\t\t\t\tthis._logoAttribution.value = this.logoUrl;\n\t\t\t\ttarget.push( this._logoAttribution );\n\n\t\t\t}\n\n\t\t\tthis._attribution.value = this._attributionsManager.toString();\n\t\t\ttarget.push( this._attribution );\n\n\t\t}\n\n\t}\n\n\tdispose() {\n\n\t\tthis.tiles.removeEventListener( 'tile-visibility-change', this._visibilityChangeCallback );\n\n\t}\n\n\tasync fetchData( uri, options ) {\n\n\t\treturn this.auth.fetch( uri, options );\n\n\t}\n\n}\n","import { CesiumIonAuth } from './auth/CesiumIonAuth.js';\nimport { GoogleCloudAuthPlugin } from './GoogleCloudAuthPlugin.js';\n\nexport class CesiumIonAuthPlugin {\n\n\tget apiToken() {\n\n\t\treturn this.auth.apiToken;\n\n\t}\n\n\tset apiToken( v ) {\n\n\t\tthis.auth.apiToken = v;\n\n\t}\n\n\tget autoRefreshToken() {\n\n\t\treturn this.auth.autoRefreshToken;\n\n\t}\n\n\tset autoRefreshToken( v ) {\n\n\t\tthis.auth.autoRefreshToken = v;\n\n\t}\n\n\tconstructor( options = {} ) {\n\n\t\tconst {\n\t\t\tapiToken,\n\t\t\tassetId = null,\n\t\t\tautoRefreshToken = false,\n\t\t\tuseRecommendedSettings = true,\n\t\t\tassetTypeHandler = ( type, tiles, asset ) => {\n\n\t\t\t\tconsole.warn( `CesiumIonAuthPlugin: Cesium Ion asset type \"${ type }\" unhandled.` );\n\n\t\t\t},\n\t\t} = options;\n\n\t\tthis.name = 'CESIUM_ION_AUTH_PLUGIN';\n\t\tthis.auth = new CesiumIonAuth( { apiToken, autoRefreshToken } );\n\n\t\tthis.assetId = assetId;\n\t\tthis.autoRefreshToken = autoRefreshToken;\n\t\tthis.useRecommendedSettings = useRecommendedSettings;\n\t\tthis.assetTypeHandler = assetTypeHandler;\n\t\tthis.tiles = null;\n\n\t\tthis._tileSetVersion = - 1;\n\t\tthis._attributions = [];\n\n\t}\n\n\tinit( tiles ) {\n\n\t\tif ( this.assetId !== null ) {\n\n\t\t\ttiles.rootURL = `https://api.cesium.com/v1/assets/${ this.assetId }/endpoint`;\n\n\t\t}\n\n\t\tthis.tiles = tiles;\n\t\tthis.auth.authURL = tiles.rootURL;\n\n\t\t// reset the tiles in case this plugin was removed and re-added\n\t\ttiles.resetFailedTiles();\n\n\t}\n\n\tloadRootTileset() {\n\n\t\t// ensure we have an up-to-date token and root url, then trigger the internal\n\t\t// root tileset load function\n\t\treturn this\n\t\t\t.auth\n\t\t\t.refreshToken()\n\t\t\t.then( json => {\n\n\t\t\t\tthis._initializeFromAsset( json );\n\t\t\t\treturn this.tiles.invokeOnePlugin( plugin => plugin !== this && plugin.loadRootTileset && plugin.loadRootTileset() );\n\n\t\t\t} )\n\t\t\t.catch( error => {\n\n\t\t\t\tthis.tiles.dispatchEvent( {\n\t\t\t\t\ttype: 'load-error',\n\t\t\t\t\ttile: null,\n\t\t\t\t\terror,\n\t\t\t\t\turl: this.auth.authURL,\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t}\n\n\tpreprocessURL( uri ) {\n\n\t\turi = new URL( uri );\n\t\tif ( /^http/.test( uri.protocol ) && this._tileSetVersion != - 1 ) {\n\n\t\t\turi.searchParams.set( 'v', this._tileSetVersion );\n\n\t\t}\n\n\t\treturn uri.toString();\n\n\t}\n\n\tfetchData( uri, options ) {\n\n\t\tconst tiles = this.tiles;\n\t\tif ( tiles.getPluginByName( 'GOOGLE_CLOUD_AUTH_PLUGIN' ) !== null ) {\n\n\t\t\treturn null;\n\n\t\t} else {\n\n\t\t\treturn this.auth.fetch( uri, options );\n\n\t\t}\n\n\t}\n\n\tgetAttributions( target ) {\n\n\t\tif ( this.tiles.visibleTiles.size > 0 ) {\n\n\t\t\ttarget.push( ...this._attributions );\n\n\t\t}\n\n\t}\n\n\t_initializeFromAsset( json ) {\n\n\t\tconst tiles = this.tiles;\n\t\tif ( 'externalType' in json ) {\n\n\t\t\tconst url = new URL( json.options.url );\n\t\t\ttiles.rootURL = json.options.url;\n\n\t\t\t// if the tileset is \"external\" then assume it's a google API tileset\n\t\t\ttiles.registerPlugin( new GoogleCloudAuthPlugin( {\n\t\t\t\tapiToken: url.searchParams.get( 'key' ),\n\t\t\t\tautoRefreshToken: this.autoRefreshToken,\n\t\t\t\tuseRecommendedSettings: this.useRecommendedSettings,\n\t\t\t} ) );\n\n\t\t} else {\n\n\t\t\t// fire callback for unhandled asset types\n\t\t\tif ( json.type !== '3DTILES' ) {\n\n\t\t\t\t// Other types include:\n\t\t\t\t// - GLTF\n\t\t\t\t// - CZML\n\t\t\t\t// - KML\n\t\t\t\t// - GEOJSON\n\t\t\t\t// - TERRAIN (QuantizedMesh)\n\t\t\t\t// - IMAGERY (TSM Tiles)\n\n\t\t\t\tthis.assetTypeHandler( json.type, tiles, json );\n\n\t\t\t}\n\n\t\t\ttiles.rootURL = json.url;\n\n\t\t\t// save the version key if present\n\t\t\tconst url = new URL( json.url );\n\t\t\tif ( url.searchParams.has( 'v' ) && this._tileSetVersion === - 1 ) {\n\n\t\t\t\tthis._tileSetVersion = url.searchParams.get( 'v' );\n\n\t\t\t}\n\n\t\t\tif ( json.attributions ) {\n\n\t\t\t\tthis._attributions = json.attributions.map( att => ( {\n\t\t\t\t\tvalue: att.html,\n\t\t\t\t\ttype: 'html',\n\t\t\t\t\tcollapsible: att.collapsible,\n\t\t\t\t} ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n}\n","import { TraversalUtils } from '3d-tiles-renderer/core';\n\nconst TILES_MAP_URL = 'https://tile.googleapis.com/v1/createSession';\n\n// Class for making fetches to Google Cloud, refreshing the token if needed.\n// Supports both the 2d map tiles API in addition to 3d tiles.\nexport class GoogleCloudAuth {\n\n\tget isMapTilesSession() {\n\n\t\treturn this.authURL === TILES_MAP_URL;\n\n\t}\n\n\tconstructor( options = {} ) {\n\n\t\tconst { apiToken, sessionOptions = null, autoRefreshToken = false } = options;\n\t\tthis.apiToken = apiToken;\n\t\tthis.autoRefreshToken = autoRefreshToken;\n\t\tthis.authURL = TILES_MAP_URL;\n\t\tthis.sessionToken = null;\n\t\tthis.sessionOptions = sessionOptions;\n\t\tthis._tokenRefreshPromise = null;\n\n\t}\n\n\tasync fetch( url, options ) {\n\n\t\t// if we're using a map tiles session then we have to refresh the token separately\n\t\tif ( this.sessionToken === null && this.isMapTilesSession ) {\n\n\t\t\tthis.refreshToken( options );\n\n\t\t}\n\n\t\tawait this._tokenRefreshPromise;\n\n\t\t// construct the url\n\t\tconst fetchUrl = new URL( url );\n\t\tfetchUrl.searchParams.set( 'key', this.apiToken );\n\t\tif ( this.sessionToken ) {\n\n\t\t\tfetchUrl.searchParams.set( 'session', this.sessionToken );\n\n\t\t}\n\n\t\t// try to refresh the session token if we failed to load it\n\t\tlet res = await fetch( fetchUrl, options );\n\t\tif ( res.status >= 400 && res.status <= 499 && this.autoRefreshToken ) {\n\n\t\t\t// refresh the session token\n\t\t\tawait this.refreshToken( options );\n\t\t\tif ( this.sessionToken ) {\n\n\t\t\t\tfetchUrl.searchParams.set( 'session', this.sessionToken );\n\n\t\t\t}\n\n\t\t\tres = await fetch( fetchUrl, options );\n\n\t\t}\n\n\t\tif ( this.sessionToken === null && ! this.isMapTilesSession ) {\n\n\t\t\t// if we're using a 3d tiles session then we get the session key in the first request\n\t\t\treturn res\n\t\t\t\t.json()\n\t\t\t\t.then( json => {\n\n\t\t\t\t\tthis.sessionToken = getSessionToken( json );\n\t\t\t\t\treturn json;\n\n\t\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn res;\n\n\t\t}\n\n\t}\n\n\trefreshToken( options ) {\n\n\t\tif ( this._tokenRefreshPromise === null ) {\n\n\t\t\t// construct the url to fetch the endpoint\n\t\t\tconst url = new URL( this.authURL );\n\t\t\turl.searchParams.set( 'key', this.apiToken );\n\n\t\t\t// initialize options for map tiles\n\t\t\tconst fetchOptions = { ...options };\n\t\t\tif ( this.isMapTilesSession ) {\n\n\t\t\t\tfetchOptions.method = 'POST';\n\t\t\t\tfetchOptions.body = JSON.stringify( this.sessionOptions );\n\t\t\t\tfetchOptions.headers = fetchOptions.headers || {};\n\t\t\t\tfetchOptions.headers = {\n\t\t\t\t\t...fetchOptions.headers,\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tthis._tokenRefreshPromise = fetch( url, fetchOptions )\n\t\t\t\t.then( res => {\n\n\t\t\t\t\tif ( ! res.ok ) {\n\n\t\t\t\t\t\tthrow new Error( `GoogleCloudAuth: Failed to load data with error code ${ res.status }` );\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn res.json();\n\n\t\t\t\t} )\n\t\t\t\t.then( json => {\n\n\t\t\t\t\tthis.sessionToken = getSessionToken( json );\n\t\t\t\t\tthis._tokenRefreshPromise = null;\n\n\t\t\t\t\treturn json;\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\treturn this._tokenRefreshPromise;\n\n\t}\n\n}\n\n// Takes a json response from the auth url and extracts the session token\nfunction getSessionToken( json ) {\n\n\tif ( 'session' in json ) {\n\n\t\t// if using the 2d maps api\n\t\treturn json.session;\n\n\t} else {\n\n\t\t// is using the 3d tiles api\n\t\tlet sessionToken = null;\n\t\tconst root = json.root;\n\t\tTraversalUtils.traverseSet( root, tile => {\n\n\t\t\tif ( tile.content && tile.content.uri ) {\n\n\t\t\t\tconst [ , params ] = tile.content.uri.split( '?' );\n\t\t\t\tsessionToken = new URLSearchParams( params ).get( 'session' );\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t\treturn false;\n\n\t\t} );\n\n\t\treturn sessionToken;\n\n\t}\n\n}\n\n","import { LoaderBase } from '3d-tiles-renderer/core';\n\nexport function zigZagDecode( value ) {\n\n\treturn ( value >> 1 ) ^ ( - ( value & 1 ) );\n\n}\n\nexport class QuantizedMeshLoaderBase extends LoaderBase {\n\n\tconstructor( ...args ) {\n\n\t\tsuper( ...args );\n\n\t\tthis.fetchOptions.header = {\n\t\t\tAccept: 'application/vnd.quantized-mesh,application/octet-stream;q=0.9',\n\t\t};\n\n\t}\n\n\tloadAsync( ...args ) {\n\n\t\tconst { fetchOptions } = this;\n\t\tfetchOptions.header = fetchOptions.header || {};\n\t\tfetchOptions.header[ 'Accept' ] = 'application/vnd.quantized-mesh,application/octet-stream;q=0.9';\n\t\tfetchOptions.header[ 'Accept' ] += ';extensions=octvertexnormals-watermask-metadata';\n\n\t\treturn super.loadAsync( ...args );\n\n\t}\n\n\tparse( buffer ) {\n\n\t\tlet pointer = 0;\n\t\tconst view = new DataView( buffer );\n\t\tconst readFloat64 = () => {\n\n\t\t\tconst result = view.getFloat64( pointer, true );\n\t\t\tpointer += 8;\n\t\t\treturn result;\n\n\t\t};\n\n\t\tconst readFloat32 = () => {\n\n\t\t\tconst result = view.getFloat32( pointer, true );\n\t\t\tpointer += 4;\n\t\t\treturn result;\n\n\t\t};\n\n\t\tconst readInt = () => {\n\n\t\t\tconst result = view.getUint32( pointer, true );\n\t\t\tpointer += 4;\n\t\t\treturn result;\n\n\t\t};\n\n\t\tconst readByte = () => {\n\n\t\t\tconst result = view.getUint8( pointer );\n\t\t\tpointer += 1;\n\t\t\treturn result;\n\n\t\t};\n\n\t\tconst readBuffer = ( count, type ) => {\n\n\t\t\tconst result = new type( buffer, pointer, count );\n\t\t\tpointer += count * type.BYTES_PER_ELEMENT;\n\t\t\treturn result;\n\n\t\t};\n\n\t\t// extract header\n\t\tconst header = {\n\t\t\tcenter: [ readFloat64(), readFloat64(), readFloat64() ],\n\t\t\tminHeight: readFloat32(),\n\t\t\tmaxHeight: readFloat32(),\n\t\t\tsphereCenter: [ readFloat64(), readFloat64(), readFloat64() ],\n\t\t\tsphereRadius: readFloat64(),\n\t\t\thorizonOcclusionPoint: [ readFloat64(), readFloat64(), readFloat64() ],\n\t\t};\n\n\t\t// extract vertex data\n\t\tconst vertexCount = readInt();\n\t\tconst uBuffer = readBuffer( vertexCount, Uint16Array );\n\t\tconst vBuffer = readBuffer( vertexCount, Uint16Array );\n\t\tconst hBuffer = readBuffer( vertexCount, Uint16Array );\n\n\t\tconst uResult = new Float32Array( vertexCount );\n\t\tconst vResult = new Float32Array( vertexCount );\n\t\tconst hResult = new Float32Array( vertexCount );\n\n\t\t// decode vertex data\n\t\tlet u = 0;\n\t\tlet v = 0;\n\t\tlet h = 0;\n\t\tconst MAX_VALUE = 32767;\n\t\tfor ( let i = 0; i < vertexCount; ++ i ) {\n\n\t\t\tu += zigZagDecode( uBuffer[ i ] );\n\t\t\tv += zigZagDecode( vBuffer[ i ] );\n\t\t\th += zigZagDecode( hBuffer[ i ] );\n\n\t\t\tuResult[ i ] = u / MAX_VALUE;\n\t\t\tvResult[ i ] = v / MAX_VALUE;\n\t\t\thResult[ i ] = h / MAX_VALUE;\n\n\t\t}\n\n\t\t// align pointer for index data\n\t\tconst is32 = vertexCount > 65536;\n\t\tconst bufferType = is32 ? Uint32Array : Uint16Array;\n\t\tif ( is32 ) {\n\n\t\t\tpointer = Math.ceil( pointer / 4 ) * 4;\n\n\t\t} else {\n\n\t\t\tpointer = Math.ceil( pointer / 2 ) * 2;\n\n\t\t}\n\n\t\t// extract index data\n\t\tconst triangleCount = readInt();\n\t\tconst indices = readBuffer( triangleCount * 3, bufferType );\n\n\t\t// decode the index data\n\t\tlet highest = 0;\n\t\tfor ( var i = 0; i < indices.length; ++ i ) {\n\n\t\t\tconst code = indices[ i ];\n\t\t\tindices[ i ] = highest - code;\n\t\t\tif ( code === 0 ) {\n\n\t\t\t\t++ highest;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// sort functions for the edges since they are not pre-sorted\n\t\tconst vSort = ( a, b ) => vResult[ b ] - vResult[ a ];\n\t\tconst vSortReverse = ( a, b ) => - vSort( a, b );\n\n\t\tconst uSort = ( a, b ) => uResult[ a ] - uResult[ b ];\n\t\tconst uSortReverse = ( a, b ) => - uSort( a, b );\n\n\t\t// get edge indices\n\t\tconst westVertexCount = readInt();\n\t\tconst westIndices = readBuffer( westVertexCount, bufferType );\n\t\twestIndices.sort( vSort );\n\n\t\tconst southVertexCount = readInt();\n\t\tconst southIndices = readBuffer( southVertexCount, bufferType );\n\t\tsouthIndices.sort( uSort );\n\n\t\tconst eastVertexCount = readInt();\n\t\tconst eastIndices = readBuffer( eastVertexCount, bufferType );\n\t\teastIndices.sort( vSortReverse );\n\n\t\tconst northVertexCount = readInt();\n\t\tconst northIndices = readBuffer( northVertexCount, bufferType );\n\t\tnorthIndices.sort( uSortReverse );\n\n\t\tconst edgeIndices = {\n\t\t\twestIndices,\n\t\t\tsouthIndices,\n\t\t\teastIndices,\n\t\t\tnorthIndices,\n\t\t};\n\n\t\t// parse extensions\n\t\tconst extensions = {};\n\t\twhile ( pointer < view.byteLength ) {\n\n\t\t\tconst extensionId = readByte();\n\t\t\tconst extensionLength = readInt();\n\n\t\t\tif ( extensionId === 1 ) {\n\n\t\t\t\t// oct encoded normals\n\t\t\t\tconst xy = readBuffer( vertexCount * 2, Uint8Array );\n\t\t\t\tconst normals = new Float32Array( vertexCount * 3 );\n\n\t\t\t\t// https://github.com/CesiumGS/cesium/blob/baaabaa49058067c855ad050be73a9cdfe9b6ac7/packages/engine/Source/Core/AttributeCompression.js#L119-L140\n\t\t\t\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\t\t\t\tlet x = ( xy[ 2 * i + 0 ] / 255 ) * 2 - 1;\n\t\t\t\t\tlet y = ( xy[ 2 * i + 1 ] / 255 ) * 2 - 1;\n\t\t\t\t\tconst z = 1.0 - ( Math.abs( x ) + Math.abs( y ) );\n\n\t\t\t\t\tif ( z < 0.0 ) {\n\n\t\t\t\t\t\tconst oldVX = x;\n\t\t\t\t\t\tx = ( 1.0 - Math.abs( y ) ) * signNotZero( oldVX );\n\t\t\t\t\t\ty = ( 1.0 - Math.abs( oldVX ) ) * signNotZero( y );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst len = Math.sqrt( x * x + y * y + z * z );\n\t\t\t\t\tnormals[ 3 * i + 0 ] = x / len;\n\t\t\t\t\tnormals[ 3 * i + 1 ] = y / len;\n\t\t\t\t\tnormals[ 3 * i + 2 ] = z / len;\n\n\t\t\t\t}\n\n\t\t\t\textensions[ 'octvertexnormals' ] = {\n\t\t\t\t\textensionId,\n\t\t\t\t\tnormals,\n\t\t\t\t};\n\n\t\t\t} else if ( extensionId === 2 ) {\n\n\t\t\t\t// water mask\n\t\t\t\tconst size = extensionLength === 1 ? 1 : 256;\n\t\t\t\tconst mask = readBuffer( size * size, Uint8Array );\n\t\t\t\textensions[ 'watermask' ] = {\n\t\t\t\t\textensionId,\n\t\t\t\t\tmask,\n\t\t\t\t\tsize,\n\t\t\t\t};\n\n\t\t\t} else if ( extensionId === 4 ) {\n\n\t\t\t\t// metadata\n\t\t\t\tconst jsonLength = readInt();\n\t\t\t\tconst jsonBuffer = readBuffer( jsonLength, Uint8Array );\n\t\t\t\tconst json = new TextDecoder().decode( jsonBuffer );\n\t\t\t\textensions[ 'metadata' ] = {\n\t\t\t\t\textensionId,\n\t\t\t\t\tjson: JSON.parse( json ),\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\t\t\theader,\n\t\t\tindices,\n\t\t\tvertexData: {\n\t\t\t\tu: uResult,\n\t\t\t\tv: vResult,\n\t\t\t\theight: hResult,\n\t\t\t},\n\t\t\tedgeIndices,\n\t\t\textensions,\n\t\t};\n\n\t}\n\n}\n\nfunction signNotZero( v ) {\n\n\treturn v < 0.0 ? - 1.0 : 1.0;\n\n}\n"],"names":["CesiumIonAuth","options","apiToken","autoRefreshToken","url","fetchOptions","res","json","GoogleAttributionsManager","line","add","creditsCount","tokens","i","l","t","a","b","countA","pair","TILES_3D_API","GoogleCloudAuthPlugin","sessionOptions","logoUrl","useRecommendedSettings","GoogleCloudAuth","tiles","auth","tile","visible","copyright","_b","_a","target","uri","CesiumIonAuthPlugin$1","v","assetId","assetTypeHandler","type","asset","plugin","error","att","TILES_MAP_URL","fetchUrl","getSessionToken","sessionToken","root","TraversalUtils.traverseSet","params","zigZagDecode","value","QuantizedMeshLoaderBase","LoaderBase","args","buffer","pointer","view","readFloat64","result","readFloat32","readInt","readByte","readBuffer","count","header","vertexCount","uBuffer","vBuffer","hBuffer","uResult","vResult","hResult","u","h","MAX_VALUE","is32","bufferType","triangleCount","indices","highest","code","vSort","vSortReverse","uSort","uSortReverse","westVertexCount","westIndices","southVertexCount","southIndices","eastVertexCount","eastIndices","northVertexCount","northIndices","edgeIndices","extensions","extensionId","extensionLength","xy","normals","x","y","z","oldVX","signNotZero","len","size","mask","jsonLength","jsonBuffer"],"mappings":";AACO,MAAMA,GAAc;AAAA,EAE1B,YAAaC,IAAU,IAAK;AAE3B,UAAM,EAAE,UAAAC,GAAU,kBAAAC,IAAmB,GAAK,IAAKF;AAC/C,SAAK,WAAWC,GAChB,KAAK,mBAAmBC,GACxB,KAAK,UAAU,MACf,KAAK,uBAAuB,MAC5B,KAAK,eAAe;AAAA,EAErB;AAAA,EAEA,MAAM,MAAOC,GAAKH,GAAU;AAE3B,UAAM,KAAK;AAGX,UAAMI,IAAe,EAAE,GAAGJ,EAAO;AACjC,IAAAI,EAAa,UAAUA,EAAa,WAAW,CAAA,GAC/CA,EAAa,UAAU;AAAA,MACtB,GAAGA,EAAa;AAAA,MAChB,eAAe,KAAK;AAAA,IACvB;AAGE,UAAMC,IAAM,MAAM,MAAOF,GAAKC,CAAY;AAC1C,WAAKC,EAAI,UAAU,OAAOA,EAAI,UAAU,OAAO,KAAK,oBAGnD,MAAM,KAAK,aAAcL,CAAO,GAChCI,EAAa,QAAQ,gBAAgB,KAAK,cAEnC,MAAOD,GAAKC,CAAY,KAIxBC;AAAA,EAIT;AAAA,EAEA,aAAcL,GAAU;AAEvB,QAAK,KAAK,yBAAyB,MAAO;AAGzC,YAAMG,IAAM,IAAI,IAAK,KAAK,OAAO;AACjC,MAAAA,EAAI,aAAa,IAAK,gBAAgB,KAAK,QAAQ,GAEnD,KAAK,uBAAuB,MAAOA,GAAKH,CAAO,EAC7C,KAAM,CAAAK,MAAO;AAEb,YAAK,CAAEA,EAAI;AAEV,gBAAM,IAAI,MAAO,4DAA6DA,EAAI,MAAM,EAAG;AAI5F,eAAOA,EAAI,KAAI;AAAA,MAEhB,CAAC,EACA,KAAM,CAAAC,OAEN,KAAK,eAAe,UAAWA,EAAK,WAAW,IAC/C,KAAK,uBAAuB,MAErBA,EAEP;AAAA,IAEH;AAEA,WAAO,KAAK;AAAA,EAEb;AAED;AC/EO,MAAMC,GAA0B;AAAA,EAEtC,cAAc;AAEb,SAAK,eAAe,CAAA;AAAA,EAErB;AAAA,EAEA,oBAAqBC,GAAMC,GAAM;AAEhC,UAAMC,IAAe,KAAK,cACpBC,IAASH,EAAK,MAAO,IAAI;AAC/B,aAAUI,IAAI,GAAGC,IAAIF,EAAO,QAAQC,IAAIC,GAAGD,KAAO;AAEjD,YAAME,IAAIH,EAAQC,CAAC;AACnB,MAASE,KAAKJ,MAEbA,EAAcI,CAAC,IAAK,IAIrBJ,EAAcI,CAAC,KAAML,IAAM,IAAI,IAE1BC,EAAcI,CAAC,KAAM,KAEzB,OAAOJ,EAAcI,CAAC;AAAA,IAIxB;AAAA,EAED;AAAA,EAEA,gBAAiBN,GAAO;AAEvB,SAAK,oBAAqBA,GAAM,EAAI;AAAA,EAErC;AAAA,EAEA,mBAAoBA,GAAO;AAE1B,SAAK,oBAAqBA,GAAM,EAAK;AAAA,EAEtC;AAAA,EAEA,WAAW;AAYV,WARsB,OAAO,QAAS,KAAK,YAAY,EAAG,KAAM,CAAEO,GAAGC,MAAO;AAE3E,YAAMC,IAASF,EAAG,CAAC;AAEnB,aADeC,EAAG,CAAC,IACHC;AAAA,IAEjB,CAAC,EAEoB,IAAK,CAAAC,MAAQA,EAAM,EAAG,EAAG,KAAM,IAAI;AAAA,EAEzD;AAED;AC1DA,MAAMC,KAAe;AAEd,MAAMC,GAAsB;AAAA,EAElC,YAAa;AAAA,IACZ,UAAAnB;AAAA,IACA,gBAAAoB,IAAiB;AAAA,IACjB,kBAAAnB,IAAmB;AAAA,IACnB,SAAAoB,IAAU;AAAA,IACV,wBAAAC,IAAyB;AAAA,EAC3B,GAAK;AAEH,SAAK,OAAO,4BAEZ,KAAK,WAAWtB,GAChB,KAAK,yBAAyBsB,GAC9B,KAAK,UAAUD,GAEf,KAAK,OAAO,IAAIE,GAAiB,EAAE,UAAAvB,GAAU,kBAAAC,GAAkB,gBAAAmB,GAAgB,GAC/E,KAAK,QAAQ,MAEb,KAAK,4BAA4B,MACjC,KAAK,uBAAuB,IAAId,GAAyB,GACzD,KAAK,mBAAmB;AAAA,MACvB,OAAO;AAAA,MACP,MAAM;AAAA,MACN,aAAa;AAAA,IAChB,GACE,KAAK,eAAe;AAAA,MACnB,OAAO;AAAA,MACP,MAAM;AAAA,MACN,aAAa;AAAA,IAChB;AAAA,EAEC;AAAA,EAEA,KAAMkB,GAAQ;AAEb,UAAM,EAAE,wBAAAF,GAAwB,MAAAG,EAAI,IAAK;AAGzC,IAAAD,EAAM,iBAAgB,GAEjBA,EAAM,WAAW,SAErBA,EAAM,UAAUN,KAIVO,EAAK,mBAEXA,EAAK,UAAUD,EAAM,UAIjBF,KAA0B,CAAEG,EAAK,sBAGrCD,EAAM,cAAc,KAIrB,KAAK,QAAQA,GAEb,KAAK,4BAA4B,CAAE,EAAE,MAAAE,GAAM,SAAAC,EAAO,MAAQ;;AAEzD,YAAMC,MAAYC,KAAAC,IAAAJ,EAAK,OAAO,aAAZ,gBAAAI,EAAsB,UAAtB,gBAAAD,EAA6B,cAAa;AAC5D,MAAKF,IAEJ,KAAK,qBAAqB,gBAAiBC,CAAS,IAIpD,KAAK,qBAAqB,mBAAoBA,CAAS;AAAA,IAIzD,GAEAJ,EAAM,iBAAkB,0BAA0B,KAAK,yBAAyB;AAAA,EAEjF;AAAA,EAEA,gBAAiBO,GAAS;AAEzB,IAAK,KAAK,MAAM,aAAa,OAAO,MAE9B,KAAK,YAET,KAAK,iBAAiB,QAAQ,KAAK,SACnCA,EAAO,KAAM,KAAK,gBAAgB,IAInC,KAAK,aAAa,QAAQ,KAAK,qBAAqB,SAAQ,GAC5DA,EAAO,KAAM,KAAK,YAAY;AAAA,EAIhC;AAAA,EAEA,UAAU;AAET,SAAK,MAAM,oBAAqB,0BAA0B,KAAK,yBAAyB;AAAA,EAEzF;AAAA,EAEA,MAAM,UAAWC,GAAKjC,GAAU;AAE/B,WAAO,KAAK,KAAK,MAAOiC,GAAKjC,CAAO;AAAA,EAErC;AAED;ACjHO,IAAAkC,KAAA,MAA0B;AAAA,EAEhC,IAAI,WAAW;AAEd,WAAO,KAAK,KAAK;AAAA,EAElB;AAAA,EAEA,IAAI,SAAUC,GAAI;AAEjB,SAAK,KAAK,WAAWA;AAAA,EAEtB;AAAA,EAEA,IAAI,mBAAmB;AAEtB,WAAO,KAAK,KAAK;AAAA,EAElB;AAAA,EAEA,IAAI,iBAAkBA,GAAI;AAEzB,SAAK,KAAK,mBAAmBA;AAAA,EAE9B;AAAA,EAEA,YAAanC,IAAU,IAAK;AAE3B,UAAM;AAAA,MACL,UAAAC;AAAA,MACA,SAAAmC,IAAU;AAAA,MACV,kBAAAlC,IAAmB;AAAA,MACnB,wBAAAqB,IAAyB;AAAA,MACzB,kBAAAc,IAAmB,CAAEC,GAAMb,GAAOc,MAAW;AAE5C,gBAAQ,KAAM,+CAAgDD,CAAI,cAAe;AAAA,MAElF;AAAA,IACH,IAAMtC;AAEJ,SAAK,OAAO,0BACZ,KAAK,OAAO,IAAID,GAAe,EAAE,UAAAE,GAAU,kBAAAC,EAAgB,CAAE,GAE7D,KAAK,UAAUkC,GACf,KAAK,mBAAmBlC,GACxB,KAAK,yBAAyBqB,GAC9B,KAAK,mBAAmBc,GACxB,KAAK,QAAQ,MAEb,KAAK,kBAAkB,IACvB,KAAK,gBAAgB,CAAA;AAAA,EAEtB;AAAA,EAEA,KAAMZ,GAAQ;AAEb,IAAK,KAAK,YAAY,SAErBA,EAAM,UAAU,oCAAqC,KAAK,OAAO,cAIlE,KAAK,QAAQA,GACb,KAAK,KAAK,UAAUA,EAAM,SAG1BA,EAAM,iBAAgB;AAAA,EAEvB;AAAA,EAEA,kBAAkB;AAIjB,WAAO,KACL,KACA,aAAY,EACZ,KAAM,CAAAnB,OAEN,KAAK,qBAAsBA,CAAI,GACxB,KAAK,MAAM,gBAAiB,CAAAkC,MAAUA,MAAW,QAAQA,EAAO,mBAAmBA,EAAO,gBAAe,CAAE,EAElH,EACA,MAAO,CAAAC,MAAS;AAEhB,WAAK,MAAM,cAAe;AAAA,QACzB,MAAM;AAAA,QACN,MAAM;AAAA,QACN,OAAAA;AAAA,QACA,KAAK,KAAK,KAAK;AAAA,MACpB,CAAK;AAAA,IAEF,CAAC;AAAA,EAEH;AAAA,EAEA,cAAeR,GAAM;AAEpB,WAAAA,IAAM,IAAI,IAAKA,CAAG,GACb,QAAQ,KAAMA,EAAI,QAAQ,KAAM,KAAK,mBAAmB,MAE5DA,EAAI,aAAa,IAAK,KAAK,KAAK,eAAe,GAIzCA,EAAI,SAAQ;AAAA,EAEpB;AAAA,EAEA,UAAWA,GAAKjC,GAAU;AAGzB,WADc,KAAK,MACR,gBAAiB,0BAA0B,MAAO,OAErD,OAIA,KAAK,KAAK,MAAOiC,GAAKjC,CAAO;AAAA,EAItC;AAAA,EAEA,gBAAiBgC,GAAS;AAEzB,IAAK,KAAK,MAAM,aAAa,OAAO,KAEnCA,EAAO,KAAM,GAAG,KAAK,aAAa;AAAA,EAIpC;AAAA,EAEA,qBAAsB1B,GAAO;AAE5B,UAAMmB,IAAQ,KAAK;AACnB,QAAK,kBAAkBnB,GAAO;AAE7B,YAAMH,IAAM,IAAI,IAAKG,EAAK,QAAQ,GAAG;AACrC,MAAAmB,EAAM,UAAUnB,EAAK,QAAQ,KAG7BmB,EAAM,eAAgB,IAAIL,GAAuB;AAAA,QAChD,UAAUjB,EAAI,aAAa,IAAK,KAAK;AAAA,QACrC,kBAAkB,KAAK;AAAA,QACvB,wBAAwB,KAAK;AAAA,MACjC,EAAM;AAAA,IAEJ,OAAO;AAGN,MAAKG,EAAK,SAAS,aAUlB,KAAK,iBAAkBA,EAAK,MAAMmB,GAAOnB,CAAI,GAI9CmB,EAAM,UAAUnB,EAAK;AAGrB,YAAMH,IAAM,IAAI,IAAKG,EAAK,GAAG;AAC7B,MAAKH,EAAI,aAAa,IAAK,GAAG,KAAM,KAAK,oBAAoB,OAE5D,KAAK,kBAAkBA,EAAI,aAAa,IAAK,GAAG,IAI5CG,EAAK,iBAET,KAAK,gBAAgBA,EAAK,aAAa,IAAK,CAAAoC,OAAS;AAAA,QACpD,OAAOA,EAAI;AAAA,QACX,MAAM;AAAA,QACN,aAAaA,EAAI;AAAA,MACtB,EAAO;AAAA,IAIL;AAAA,EAED;AAED;AC/LA,MAAMC,IAAgB;AAIf,MAAMnB,GAAgB;AAAA,EAE5B,IAAI,oBAAoB;AAEvB,WAAO,KAAK,YAAYmB;AAAA,EAEzB;AAAA,EAEA,YAAa3C,IAAU,IAAK;AAE3B,UAAM,EAAE,UAAAC,GAAU,gBAAAoB,IAAiB,MAAM,kBAAAnB,IAAmB,GAAK,IAAKF;AACtE,SAAK,WAAWC,GAChB,KAAK,mBAAmBC,GACxB,KAAK,UAAUyC,GACf,KAAK,eAAe,MACpB,KAAK,iBAAiBtB,GACtB,KAAK,uBAAuB;AAAA,EAE7B;AAAA,EAEA,MAAM,MAAOlB,GAAKH,GAAU;AAG3B,IAAK,KAAK,iBAAiB,QAAQ,KAAK,qBAEvC,KAAK,aAAcA,CAAO,GAI3B,MAAM,KAAK;AAGX,UAAM4C,IAAW,IAAI,IAAKzC,CAAG;AAC7B,IAAAyC,EAAS,aAAa,IAAK,OAAO,KAAK,QAAQ,GAC1C,KAAK,gBAETA,EAAS,aAAa,IAAK,WAAW,KAAK,YAAY;AAKxD,QAAIvC,IAAM,MAAM,MAAOuC,GAAU5C,CAAO;AAexC,WAdKK,EAAI,UAAU,OAAOA,EAAI,UAAU,OAAO,KAAK,qBAGnD,MAAM,KAAK,aAAcL,CAAO,GAC3B,KAAK,gBAET4C,EAAS,aAAa,IAAK,WAAW,KAAK,YAAY,GAIxDvC,IAAM,MAAM,MAAOuC,GAAU5C,CAAO,IAIhC,KAAK,iBAAiB,QAAQ,CAAE,KAAK,oBAGlCK,EACL,KAAI,EACJ,KAAM,CAAAC,OAEN,KAAK,eAAeuC,EAAiBvC,CAAI,GAClCA,EAEP,IAIKD;AAAA,EAIT;AAAA,EAEA,aAAcL,GAAU;AAEvB,QAAK,KAAK,yBAAyB,MAAO;AAGzC,YAAMG,IAAM,IAAI,IAAK,KAAK,OAAO;AACjC,MAAAA,EAAI,aAAa,IAAK,OAAO,KAAK,QAAQ;AAG1C,YAAMC,IAAe,EAAE,GAAGJ,EAAO;AACjC,MAAK,KAAK,sBAETI,EAAa,SAAS,QACtBA,EAAa,OAAO,KAAK,UAAW,KAAK,cAAc,GACvDA,EAAa,UAAUA,EAAa,WAAW,CAAA,GAC/CA,EAAa,UAAU;AAAA,QACtB,GAAGA,EAAa;AAAA,QAChB,gBAAgB;AAAA,MACrB,IAIG,KAAK,uBAAuB,MAAOD,GAAKC,CAAY,EAClD,KAAM,CAAAC,MAAO;AAEb,YAAK,CAAEA,EAAI;AAEV,gBAAM,IAAI,MAAO,wDAAyDA,EAAI,MAAM,EAAG;AAIxF,eAAOA,EAAI,KAAI;AAAA,MAEhB,CAAC,EACA,KAAM,CAAAC,OAEN,KAAK,eAAeuC,EAAiBvC,CAAI,GACzC,KAAK,uBAAuB,MAErBA,EAEP;AAAA,IAEH;AAEA,WAAO,KAAK;AAAA,EAEb;AAED;AAGA,SAASuC,EAAiBvC,GAAO;AAEhC,MAAK,aAAaA;AAGjB,WAAOA,EAAK;AAEN;AAGN,QAAIwC,IAAe;AACnB,UAAMC,IAAOzC,EAAK;AAClB0C,WAAAA,GAA4BD,GAAM,CAAApB,MAAQ;AAEzC,UAAKA,EAAK,WAAWA,EAAK,QAAQ,KAAM;AAEvC,cAAM,CAAA,EAAIsB,CAAM,IAAKtB,EAAK,QAAQ,IAAI,MAAO,GAAG;AAChD,eAAAmB,IAAe,IAAI,gBAAiBG,CAAM,EAAG,IAAK,SAAS,GACpD;AAAA,MAER;AAEA,aAAO;AAAA,IAER,CAAC,GAEMH;AAAA,EAER;AAED;AClKO,SAASI,EAAcC,GAAQ;AAErC,SAASA,KAAS,IAAQ,EAAIA,IAAQ;AAEvC;AAEO,MAAMC,WAAgCC,GAAW;AAAA,EAEvD,eAAgBC,GAAO;AAEtB,UAAO,GAAGA,CAAI,GAEd,KAAK,aAAa,SAAS;AAAA,MAC1B,QAAQ;AAAA,IACX;AAAA,EAEC;AAAA,EAEA,aAAcA,GAAO;AAEpB,UAAM,EAAE,cAAAlD,EAAY,IAAK;AACzB,WAAAA,EAAa,SAASA,EAAa,UAAU,CAAA,GAC7CA,EAAa,OAAQ,SAAa,iEAClCA,EAAa,OAAQ,UAAc,mDAE5B,MAAM,UAAW,GAAGkD,CAAI;AAAA,EAEhC;AAAA,EAEA,MAAOC,GAAS;AAEf,QAAIC,IAAU;AACd,UAAMC,IAAO,IAAI,SAAUF,CAAM,GAC3BG,IAAc,MAAM;AAEzB,YAAMC,IAASF,EAAK,WAAYD,GAAS,EAAI;AAC7C,aAAAA,KAAW,GACJG;AAAA,IAER,GAEMC,IAAc,MAAM;AAEzB,YAAMD,IAASF,EAAK,WAAYD,GAAS,EAAI;AAC7C,aAAAA,KAAW,GACJG;AAAA,IAER,GAEME,IAAU,MAAM;AAErB,YAAMF,IAASF,EAAK,UAAWD,GAAS,EAAI;AAC5C,aAAAA,KAAW,GACJG;AAAA,IAER,GAEMG,IAAW,MAAM;AAEtB,YAAMH,IAASF,EAAK,SAAUD,CAAO;AACrC,aAAAA,KAAW,GACJG;AAAA,IAER,GAEMI,IAAa,CAAEC,GAAO1B,MAAU;AAErC,YAAMqB,IAAS,IAAIrB,EAAMiB,GAAQC,GAASQ,CAAK;AAC/C,aAAAR,KAAWQ,IAAQ1B,EAAK,mBACjBqB;AAAA,IAER,GAGMM,IAAS;AAAA,MACd,QAAQ,CAAEP,EAAW,GAAIA,EAAW,GAAIA,EAAW,CAAE;AAAA,MACrD,WAAWE,EAAW;AAAA,MACtB,WAAWA,EAAW;AAAA,MACtB,cAAc,CAAEF,EAAW,GAAIA,EAAW,GAAIA,EAAW,CAAE;AAAA,MAC3D,cAAcA,EAAW;AAAA,MACzB,uBAAuB,CAAEA,EAAW,GAAIA,EAAW,GAAIA,EAAW,CAAE;AAAA,IACvE,GAGQQ,IAAcL,EAAO,GACrBM,IAAUJ,EAAYG,GAAa,WAAW,GAC9CE,IAAUL,EAAYG,GAAa,WAAW,GAC9CG,IAAUN,EAAYG,GAAa,WAAW,GAE9CI,IAAU,IAAI,aAAcJ,CAAW,GACvCK,IAAU,IAAI,aAAcL,CAAW,GACvCM,IAAU,IAAI,aAAcN,CAAW;AAG7C,QAAIO,IAAI,GACJtC,IAAI,GACJuC,IAAI;AACR,UAAMC,IAAY;AAClB,aAAU/D,IAAI,GAAGA,IAAIsD,GAAa,EAAGtD;AAEpC,MAAA6D,KAAKvB,EAAciB,EAASvD,EAAG,GAC/BuB,KAAKe,EAAckB,EAASxD,EAAG,GAC/B8D,KAAKxB,EAAcmB,EAASzD,EAAG,GAE/B0D,EAAS1D,KAAM6D,IAAIE,GACnBJ,EAAS3D,KAAMuB,IAAIwC,GACnBH,EAAS5D,KAAM8D,IAAIC;AAKpB,UAAMC,IAAOV,IAAc,OACrBW,IAAaD,IAAO,cAAc;AACxC,IAAKA,IAEJpB,IAAU,KAAK,KAAMA,IAAU,CAAC,IAAK,IAIrCA,IAAU,KAAK,KAAMA,IAAU,CAAC,IAAK;AAKtC,UAAMsB,IAAgBjB,EAAO,GACvBkB,IAAUhB,EAAYe,IAAgB,GAAGD,CAAU;AAGzD,QAAIG,IAAU;AACd,aAAUpE,IAAI,GAAGA,IAAImE,EAAQ,QAAQ,EAAGnE,GAAI;AAE3C,YAAMqE,IAAOF,EAASnE,CAAC;AACvB,MAAAmE,EAASnE,KAAMoE,IAAUC,GACpBA,MAAS,KAEb,EAAGD;AAAA,IAIL;AAGA,UAAME,IAAQ,CAAEnE,GAAGC,MAAOuD,EAASvD,CAAC,IAAKuD,EAASxD,CAAC,GAC7CoE,IAAe,CAAEpE,GAAGC,MAAO,CAAEkE,EAAOnE,GAAGC,CAAC,GAExCoE,IAAQ,CAAErE,GAAGC,MAAOsD,EAASvD,CAAC,IAAKuD,EAAStD,CAAC,GAC7CqE,IAAe,CAAEtE,GAAGC,MAAO,CAAEoE,EAAOrE,GAAGC,CAAC,GAGxCsE,IAAkBzB,EAAO,GACzB0B,IAAcxB,EAAYuB,GAAiBT,CAAU;AAC3D,IAAAU,EAAY,KAAML,CAAK;AAEvB,UAAMM,IAAmB3B,EAAO,GAC1B4B,IAAe1B,EAAYyB,GAAkBX,CAAU;AAC7D,IAAAY,EAAa,KAAML,CAAK;AAExB,UAAMM,IAAkB7B,EAAO,GACzB8B,IAAc5B,EAAY2B,GAAiBb,CAAU;AAC3D,IAAAc,EAAY,KAAMR,CAAY;AAE9B,UAAMS,IAAmB/B,EAAO,GAC1BgC,IAAe9B,EAAY6B,GAAkBf,CAAU;AAC7D,IAAAgB,EAAa,KAAMR,CAAY;AAE/B,UAAMS,KAAc;AAAA,MACnB,aAAAP;AAAA,MACA,cAAAE;AAAA,MACA,aAAAE;AAAA,MACA,cAAAE;AAAA,IACH,GAGQE,IAAa,CAAA;AACnB,WAAQvC,IAAUC,EAAK,cAAa;AAEnC,YAAMuC,IAAclC,EAAQ,GACtBmC,IAAkBpC,EAAO;AAE/B,UAAKmC,MAAgB,GAAI;AAGxB,cAAME,IAAKnC,EAAYG,IAAc,GAAG,UAAU,GAC5CiC,IAAU,IAAI,aAAcjC,IAAc,CAAC;AAGjD,iBAAUtD,IAAI,GAAGA,IAAIsD,GAAatD,KAAO;AAExC,cAAIwF,IAAMF,EAAI,IAAItF,IAAI,CAAC,IAAK,MAAQ,IAAI,GACpCyF,IAAMH,EAAI,IAAItF,IAAI,CAAC,IAAK,MAAQ,IAAI;AACxC,gBAAM0F,IAAI,KAAQ,KAAK,IAAKF,CAAC,IAAK,KAAK,IAAKC;AAE5C,cAAKC,IAAI,GAAM;AAEd,kBAAMC,IAAQH;AACd,YAAAA,KAAM,IAAM,KAAK,IAAKC,CAAC,KAAOG,EAAaD,CAAK,GAChDF,KAAM,IAAM,KAAK,IAAKE,CAAK,KAAOC,EAAaH,CAAC;AAAA,UAEjD;AAEA,gBAAMI,IAAM,KAAK,KAAML,IAAIA,IAAIC,IAAIA,IAAIC,IAAIA,CAAC;AAC5C,UAAAH,EAAS,IAAIvF,IAAI,CAAC,IAAKwF,IAAIK,GAC3BN,EAAS,IAAIvF,IAAI,CAAC,IAAKyF,IAAII,GAC3BN,EAAS,IAAIvF,IAAI,CAAC,IAAK0F,IAAIG;AAAA,QAE5B;AAEA,QAAAV,EAAY,mBAAuB;AAAA,UAClC,aAAAC;AAAA,UACA,SAAAG;AAAA,QACL;AAAA,MAEG,WAAYH,MAAgB,GAAI;AAG/B,cAAMU,IAAOT,MAAoB,IAAI,IAAI,KACnCU,IAAO5C,EAAY2C,IAAOA,GAAM,UAAU;AAChD,QAAAX,EAAY,YAAgB;AAAA,UAC3B,aAAAC;AAAA,UACA,MAAAW;AAAA,UACA,MAAAD;AAAA,QACL;AAAA,MAEG,WAAYV,MAAgB,GAAI;AAG/B,cAAMY,IAAa/C,EAAO,GACpBgD,IAAa9C,EAAY6C,GAAY,UAAU,GAC/CtG,IAAO,IAAI,cAAc,OAAQuG,CAAU;AACjD,QAAAd,EAAY,WAAe;AAAA,UAC1B,aAAAC;AAAA,UACA,MAAM,KAAK,MAAO1F,CAAI;AAAA,QAC3B;AAAA,MAEG;AAAA,IAED;AAEA,WAAO;AAAA,MACN,QAAA2D;AAAA,MACA,SAAAc;AAAA,MACA,YAAY;AAAA,QACX,GAAGT;AAAA,QACH,GAAGC;AAAA,QACH,QAAQC;AAAA,MACZ;AAAA,MACG,aAAAsB;AAAA,MACA,YAAAC;AAAA,IACH;AAAA,EAEC;AAED;AAEA,SAASS,EAAarE,GAAI;AAEzB,SAAOA,IAAI,IAAM,KAAQ;AAE1B;"}