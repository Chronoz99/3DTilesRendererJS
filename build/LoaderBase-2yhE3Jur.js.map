{"version":3,"file":"LoaderBase-2yhE3Jur.js","sources":["../src/core/renderer/utilities/TraversalUtils.js","../src/core/renderer/utilities/LoaderUtils.js","../src/core/renderer/loaders/LoaderBase.js"],"sourcesContent":["// Helper function for traversing a tileset. If `beforeCb` returns `true` then the\n// traversal will end early.\nexport function traverseSet( tile, beforeCb = null, afterCb = null ) {\n\n\tconst stack = [];\n\n\t// A stack-based, depth-first traversal, storing\n\t// triplets (tile, parent, depth) in the stack array.\n\n\tstack.push( tile );\n\tstack.push( null );\n\tstack.push( 0 );\n\n\twhile ( stack.length > 0 ) {\n\n\t\tconst depth = stack.pop();\n\t\tconst parent = stack.pop();\n\t\tconst tile = stack.pop();\n\n\t\tif ( beforeCb && beforeCb( tile, parent, depth ) ) {\n\n\t\t\tif ( afterCb ) {\n\n\t\t\t\tafterCb( tile, parent, depth );\n\n\t\t\t}\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst children = tile.children;\n\n\t\t// Children might be undefined if the tile has not been preprocessed yet\n\t\tif ( children ) {\n\n\t\t\tfor ( let i = children.length - 1; i >= 0; i -- ) {\n\n\t\t\t\tstack.push( children[ i ] );\n\t\t\t\tstack.push( tile );\n\t\t\t\tstack.push( depth + 1 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( afterCb ) {\n\n\t\t\tafterCb( tile, parent, depth );\n\n\t\t}\n\n\t}\n\n}\n\n// Traverses the ancestry of the tile up to the root tile.\nexport function traverseAncestors( tile, callback = null ) {\n\n\tlet current = tile;\n\n\twhile ( current ) {\n\n\t\tconst depth = current.internal.depth;\n\t\tconst parent = current.parent;\n\n\t\tif ( callback ) {\n\n\t\t\tcallback( current, parent, depth );\n\n\t\t}\n\n\t\tcurrent = parent;\n\n\t}\n\n\n}\n","export function readMagicBytes( bufferOrDataView ) {\n\n\tif ( bufferOrDataView === null || bufferOrDataView.byteLength < 4 ) {\n\n\t\treturn '';\n\n\t}\n\n\tlet view;\n\tif ( bufferOrDataView instanceof DataView ) {\n\n\t\tview = bufferOrDataView;\n\n\t} else {\n\n\t\tview = new DataView( bufferOrDataView );\n\n\t}\n\n\tif ( String.fromCharCode( view.getUint8( 0 ) ) === '{' ) {\n\n\t\treturn null;\n\n\t}\n\n\tlet magicBytes = '';\n\tfor ( let i = 0; i < 4; i ++ ) {\n\n\t\tmagicBytes += String.fromCharCode( view.getUint8( i ) );\n\n\t}\n\n\treturn magicBytes;\n\n}\n\nconst utf8decoder = new TextDecoder();\nexport function arrayToString( array ) {\n\n\treturn utf8decoder.decode( array );\n\n}\n\n// Returns a working path with a trailing slash\nexport function getWorkingPath( url ) {\n\n\treturn url.replace( /[\\\\/][^\\\\/]+$/, '' ) + '/';\n\n}\n","import { getWorkingPath } from '../utilities/LoaderUtils.js';\n\nexport class LoaderBase {\n\n\tconstructor() {\n\n\t\tthis.fetchOptions = {};\n\t\tthis.workingPath = '';\n\n\t}\n\n\tload( ...args ) {\n\n\t\tconsole.warn( 'Loader: \"load\" function has been deprecated in favor of \"loadAsync\".' );\n\t\treturn this.loadAsync( ...args );\n\n\t}\n\n\tloadAsync( url ) {\n\n\t\treturn fetch( url, this.fetchOptions )\n\t\t\t.then( res => {\n\n\t\t\t\tif ( ! res.ok ) {\n\n\t\t\t\t\tthrow new Error( `Failed to load file \"${ url }\" with status ${ res.status } : ${ res.statusText }` );\n\n\t\t\t\t}\n\n\t\t\t\treturn res.arrayBuffer();\n\n\t\t\t} )\n\t\t\t.then( buffer => {\n\n\t\t\t\tif ( this.workingPath === '' ) {\n\n\t\t\t\t\tthis.workingPath = getWorkingPath( url );\n\n\t\t\t\t}\n\n\t\t\t\treturn this.parse( buffer );\n\n\t\t\t} );\n\n\t}\n\n\tresolveExternalURL( url ) {\n\n\t\treturn new URL( url, this.workingPath ).href;\n\n\t}\n\n\tparse( buffer ) {\n\n\t\tthrow new Error( 'LoaderBase: Parse not implemented.' );\n\n\t}\n\n}\n"],"names":["traverseSet","tile","beforeCb","afterCb","stack","depth","parent","children","i","traverseAncestors","callback","current","readMagicBytes","bufferOrDataView","view","magicBytes","utf8decoder","arrayToString","array","getWorkingPath","url","LoaderBase","args","res","buffer"],"mappings":"AAEO,SAASA,EAAaC,GAAMC,IAAW,MAAMC,IAAU,MAAO;AAEpE,QAAMC,IAAQ,CAAA;AASd,OAJAA,EAAM,KAAMH,CAAI,GAChBG,EAAM,KAAM,IAAI,GAChBA,EAAM,KAAM,CAAC,GAELA,EAAM,SAAS,KAAI;AAE1B,UAAMC,IAAQD,EAAM,IAAG,GACjBE,IAASF,EAAM,IAAG,GAClBH,IAAOG,EAAM,IAAG;AAEtB,QAAKF,KAAYA,EAAUD,GAAMK,GAAQD,CAAK,GAAK;AAElD,MAAKF,KAEJA,EAASF,GAAMK,GAAQD,CAAK;AAI7B;AAAA,IAED;AAEA,UAAME,IAAWN,EAAK;AAGtB,QAAKM;AAEJ,eAAUC,IAAID,EAAS,SAAS,GAAGC,KAAK,GAAGA;AAE1C,QAAAJ,EAAM,KAAMG,EAAUC,EAAG,GACzBJ,EAAM,KAAMH,CAAI,GAChBG,EAAM,KAAMC,IAAQ,CAAC;AAMvB,IAAKF,KAEJA,EAASF,GAAMK,GAAQD,CAAK;AAAA,EAI9B;AAED;AAGO,SAASI,EAAmBR,GAAMS,IAAW,MAAO;AAE1D,MAAIC,IAAUV;AAEd,SAAQU,KAAU;AAEjB,UAAMN,IAAQM,EAAQ,SAAS,OACzBL,IAASK,EAAQ;AAEvB,IAAKD,KAEJA,EAAUC,GAASL,GAAQD,CAAK,GAIjCM,IAAUL;AAAA,EAEX;AAGD;;;;;;AC7EO,SAASM,EAAgBC,GAAmB;AAElD,MAAKA,MAAqB,QAAQA,EAAiB,aAAa;AAE/D,WAAO;AAIR,MAAIC;AAWJ,MAVKD,aAA4B,WAEhCC,IAAOD,IAIPC,IAAO,IAAI,SAAUD,CAAgB,GAIjC,OAAO,aAAcC,EAAK,SAAU,CAAC,CAAE,MAAO;AAElD,WAAO;AAIR,MAAIC,IAAa;AACjB,WAAUP,IAAI,GAAGA,IAAI,GAAGA;AAEvB,IAAAO,KAAc,OAAO,aAAcD,EAAK,SAAUN,CAAC,CAAE;AAItD,SAAOO;AAER;AAEA,MAAMC,IAAc,IAAI,YAAW;AAC5B,SAASC,EAAeC,GAAQ;AAEtC,SAAOF,EAAY,OAAQE,CAAK;AAEjC;AAGO,SAASC,EAAgBC,GAAM;AAErC,SAAOA,EAAI,QAAS,iBAAiB,EAAE,IAAK;AAE7C;;;;;;;AC9CO,MAAMC,EAAW;AAAA,EAEvB,cAAc;AAEb,SAAK,eAAe,CAAA,GACpB,KAAK,cAAc;AAAA,EAEpB;AAAA,EAEA,QAASC,GAAO;AAEf,mBAAQ,KAAM,sEAAsE,GAC7E,KAAK,UAAW,GAAGA,CAAI;AAAA,EAE/B;AAAA,EAEA,UAAWF,GAAM;AAEhB,WAAO,MAAOA,GAAK,KAAK,YAAY,EAClC,KAAM,CAAAG,MAAO;AAEb,UAAK,CAAEA,EAAI;AAEV,cAAM,IAAI,MAAO,wBAAyBH,CAAG,iBAAmBG,EAAI,YAAcA,EAAI,UAAU,EAAG;AAIpG,aAAOA,EAAI,YAAW;AAAA,IAEvB,CAAC,EACA,KAAM,CAAAC,OAED,KAAK,gBAAgB,OAEzB,KAAK,cAAcL,EAAgBC,CAAG,IAIhC,KAAK,MAAOI,CAAM,EAEzB;AAAA,EAEH;AAAA,EAEA,mBAAoBJ,GAAM;AAEzB,WAAO,IAAI,IAAKA,GAAK,KAAK,WAAW,EAAG;AAAA,EAEzC;AAAA,EAEA,MAAOI,GAAS;AAEf,UAAM,IAAI,MAAO,oCAAoC;AAAA,EAEtD;AAED;"}